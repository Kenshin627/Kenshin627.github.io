<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#000"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#000">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/black/pace-theme-corner-indicator.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="从零实现软渲染(三)：Rasterize&#x2F;绘制三角形在上一篇文章《窗口系统&#x2F;viewport》中，通过SDL库我们搭建了一个简易的窗口系统，并通过SDL内置API在屏幕中心绘制了一个矩形来测试RenderLoop。本章我们将实现自己的渲染器，用它绘制一个三角形。但在开始前，让我们先回顾下渲染的核心概念。 渲染器有两个核心任务：解决可见性和着色。解决可见性通常有两种方式：光栅化和光追。这两种常用的算">
<meta property="og:type" content="article">
<meta property="og:title" content="从零实现软渲染(三)：Rasterize&#x2F;绘制三角形">
<meta property="og:url" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/index.html">
<meta property="og:site_name" content="Pixel World">
<meta property="og:description" content="从零实现软渲染(三)：Rasterize&#x2F;绘制三角形在上一篇文章《窗口系统&#x2F;viewport》中，通过SDL库我们搭建了一个简易的窗口系统，并通过SDL内置API在屏幕中心绘制了一个矩形来测试RenderLoop。本章我们将实现自己的渲染器，用它绘制一个三角形。但在开始前，让我们先回顾下渲染的核心概念。 渲染器有两个核心任务：解决可见性和着色。解决可见性通常有两种方式：光栅化和光追。这两种常用的算">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/14.jpg">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/15.jpg">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/2.png">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/5.png">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/6.png">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/7.png">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/1.jpg">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/3.jpg">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/9.png">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f6e50d371e63476484048a90d057f4ed~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1148&amp;h=506&amp;s=315636&amp;e=png&amp;b=fefefe">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb03b0491f26406da8c9d6fab0f8ecee~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1118&amp;h=485&amp;s=220600&amp;e=png&amp;b=fefefe">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/11.jpg">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/12.jpg">
<meta property="og:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/13.jpg">
<meta property="article:published_time" content="2023-10-05T01:25:07.000Z">
<meta property="article:modified_time" content="2024-05-01T02:20:40.567Z">
<meta property="article:author" content="KenShin">
<meta property="article:tag" content="Computer Graphic">
<meta property="article:tag" content="Soft Renderer">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/14.jpg">


<link rel="canonical" href="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/","path":"2023/10/05/从零实现软渲染-三-Rasterize-绘制三角形/","title":"从零实现软渲染(三)：Rasterize/绘制三角形"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>从零实现软渲染(三)：Rasterize/绘制三角形 | Pixel World</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Pixel World</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">it's better be burning out than to fade away.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-%EF%BC%9ARasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2"><span class="nav-number">1.</span> <span class="nav-text">从零实现软渲染(三)：Rasterize&#x2F;绘制三角形</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%89%E6%A0%85%E5%8C%96%E6%A6%82%E8%A7%88"><span class="nav-number">1.1.</span> <span class="nav-text">光栅化概览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA%E6%A6%82%E8%A7%88"><span class="nav-number">1.2.</span> <span class="nav-text">光线追踪概览</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%89%E6%A0%85%E5%8C%96"><span class="nav-number">2.</span> <span class="nav-text">光栅化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#InSide%E5%88%A4%E5%AE%9A"><span class="nav-number">2.1.</span> <span class="nav-text">InSide判定</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CrossProduct"><span class="nav-number">2.1.1.</span> <span class="nav-text">CrossProduct</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BaryCentric"><span class="nav-number">2.1.2.</span> <span class="nav-text">BaryCentric</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Triangle-Pipeline"><span class="nav-number">2.2.</span> <span class="nav-text">Triangle Pipeline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NdcSpace-%E2%86%92-ScreenSpace"><span class="nav-number">2.3.</span> <span class="nav-text">NdcSpace → ScreenSpace</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Viewport"><span class="nav-number">2.3.1.</span> <span class="nav-text">Viewport</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E8%A7%92%E5%BD%A2%E5%8C%85%E5%9B%B4%E7%9B%92"><span class="nav-number">2.4.</span> <span class="nav-text">三角形包围盒</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E5%BF%83%E5%9D%90%E6%A0%87"><span class="nav-number">2.5.</span> <span class="nav-text">重心坐标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">2.5.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E5%BA%A6%E6%AF%94"><span class="nav-number">2.5.2.</span> <span class="nav-text">高度比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E7%A7%AF%E6%AF%94"><span class="nav-number">2.5.3.</span> <span class="nav-text">面积比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E7%BB%84%E5%90%88"><span class="nav-number">2.5.4.</span> <span class="nav-text">线性组合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E9%87%8D%E5%BF%83%E5%9D%90%E6%A0%87"><span class="nav-number">2.5.5.</span> <span class="nav-text">计算重心坐标</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%98%E5%88%B6"><span class="nav-number">2.6.</span> <span class="nav-text">绘制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Renderer"><span class="nav-number">3.</span> <span class="nav-text">Renderer</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E5%BD%A9%E8%89%B2%E4%B8%89%E8%A7%92%E5%BD%A2"><span class="nav-number">3.1.</span> <span class="nav-text">绘制彩色三角形</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-number">4.</span> <span class="nav-text">结语</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="KenShin"
      src="/images/author.png">
  <p class="site-author-name" itemprop="name">KenShin</p>
  <div class="site-description" itemprop="description">it's better be burning out than to fade away.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/kenshin627" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;kenshin627" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/kenshin20207@163.com" title="E-Mail → kenshin20207@163.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/97340526/" title="BiliBili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;97340526&#x2F;" rel="noopener me" target="_blank"><i class="fa-brands fa-bilibili fa-fw"></i>BiliBili</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://music.163.com/#/user/home?id=11906050" title="网易云 → https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;11906050" rel="noopener me" target="_blank"><i class="fa-solid fa-music fa-fw"></i>网易云</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/05/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%B8%89-Rasterize-%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.png">
      <meta itemprop="name" content="KenShin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pixel World">
      <meta itemprop="description" content="it's better be burning out than to fade away.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="从零实现软渲染(三)：Rasterize/绘制三角形 | Pixel World">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          从零实现软渲染(三)：Rasterize/绘制三角形
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-05 09:25:07" itemprop="dateCreated datePublished" datetime="2023-10-05T09:25:07+08:00">2023-10-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-05-01 10:20:40" itemprop="dateModified" datetime="2024-05-01T10:20:40+08:00">2024-05-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer-Graphic/" itemprop="url" rel="index"><span itemprop="name">Computer Graphic</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer-Graphic/Math/" itemprop="url" rel="index"><span itemprop="name">Math</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer-Graphic/Math/Soft-Renderer/" itemprop="url" rel="index"><span itemprop="name">Soft Renderer</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>13 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="从零实现软渲染-三-：Rasterize-绘制三角形"><a href="#从零实现软渲染-三-：Rasterize-绘制三角形" class="headerlink" title="从零实现软渲染(三)：Rasterize/绘制三角形"></a>从零实现软渲染(三)：Rasterize/绘制三角形</h1><p>在上一篇文章《窗口系统/viewport》中，通过SDL库我们搭建了一个简易的窗口系统，并通过SDL内置API在屏幕中心绘制了一个矩形来测试RenderLoop。<br>本章我们将实现自己的渲染器，用它绘制一个三角形。但在开始前，让我们先回顾下渲染的核心概念。</p>
<p>渲染器有两个核心任务：解决<strong><em>可见性</em></strong>和<strong><em>着色</em></strong>。解决可见性通常有两种方式：<strong><em>光栅化</em></strong>和<strong><em>光追</em></strong>。这两种常用的算法用于解决渲染中的可见性问题, 即找到哪些物体在相机下的视口是可见的.<br><span id="more"></span></p>
<h2 id="光栅化概览"><a href="#光栅化概览" class="headerlink" title="光栅化概览"></a>光栅化概览</h2><p><img src="14.jpg" alt="14.jpg"></p>
<p>光栅化本质上是一种基于图元(Triangle Line Point…)解决可见性问题的一种算法, 所谓基于图元,是指对于每一个图元我们会计算屏幕上哪些像素被该图元覆盖,<strong><em>光栅化算法的外层循环为图元集合,内循环为屏幕像素</em></strong>,伪代码如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">const</span> Model&amp; model: models)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">const</span> Triangle&amp; triangle: model.<span class="built_in">getTriangles</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        BoundingBox bbox = <span class="built_in">CalcBoundingBox</span>(triangle);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">size_t</span> y = bbox.min.y; y &lt;= bbox.max.y; y++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">size_t</span> x = bbox.min.x; x &lt;= bbox.max.x; x++)</span><br><span class="line">            &#123;</span><br><span class="line">                Point p &#123; x + <span class="number">0.5f</span>, y + <span class="number">0.5f</span> &#125;;</span><br><span class="line">                <span class="type">bool</span> inside = <span class="built_in">isInsideTriangle</span>(triangle, p);</span><br><span class="line">                <span class="keyword">if</span>(inside &amp;&amp; zValue &gt; zBuffer[currentValue])</span><br><span class="line">                &#123;           </span><br><span class="line">                    <span class="built_in">shading</span>(p);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;     </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过以上伪代码我们不难发现,光栅化是如何基于图元进行操作的,它会遍历每一个图元, 根据图元生成包围盒, 遍历包围盒内部的像素, 通过inSide(是否在三角形内部)判断当前像素点是否被图元所覆盖,如果在三角形内部并且当前片元的z值大于zbuffer所存储的z值,则执行着色逻辑.</p>
<p>光栅化的优缺点:</p>
<ul>
<li>相较于光线追踪,光栅化计算速度快</li>
<li>难以处理全局光照问题,但是可以通过其他方式模拟近似,例如 shadowMaps SSAO IBL等;</li>
<li><h2 id="光线追踪概览"><a href="#光线追踪概览" class="headerlink" title="光线追踪概览"></a>光线追踪概览</h2></li>
</ul>
<p><img src="15.jpg" alt="15.jpg"></p>
<p>和光栅化从图元出发不同,光线追踪是从屏幕像素出发,从摄像机位置出发,往每个像素方向发射光线(RayRayRay),计算光线与场景(boundingBox/mesh/primitives)求交,找到最近相交的图元,递归计算光照的过程.因此我们可以说<strong>光线追踪是基于屏幕空间像素解决可见性问题的一种算法</strong>.</p>
<p><strong><em>光线追踪和光栅化相反,光线追踪外层循环为屏幕像素,内层循环为图元.</em></strong>,同样我们用伪代码简单描述光线追踪的运行逻辑:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Viewport viewpot&#123; width, height &#125;;</span><br><span class="line">Camera camera;</span><br><span class="line"><span class="comment">//遍历屏幕二维空间</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">size_t</span> y = <span class="number">0</span>; y &lt;= viewport.height; y++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">size_t</span> x = <span class="number">0</span>; x &lt;= viewport.widht; x++)</span><br><span class="line">    &#123;</span><br><span class="line">        Ray ray = camera.<span class="built_in">castRay</span>(x, y);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">size_t</span> i = <span class="number">0</span>; i &lt;= modelsOrBvhs; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">RayIntersection</span>(modelsOrBvhs[i], ray);</span><br><span class="line">            <span class="comment">//recursive calc shading...            </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><em>光线追踪是向屏幕空间每个像素发射一条光线, 计算光线与场景(Bvhs)最近的交点,递归计算光照的过程.</em></strong></p>
<h1 id="光栅化"><a href="#光栅化" class="headerlink" title="光栅化"></a>光栅化</h1><p>本章我们着重讲解光栅化的实现。光栅化即将图元信息离散化到屏幕像素的过程。 这其中涉及一系列的步骤：</p>
<p>1.首先我们知道原始顶点经过$Model/View/Projection$变换及透视除法后,顶点坐标处于NDC空间中，而光栅化实际上是对屏幕上的像素做处理，因此第一步首先需要将NDC空间中的顶点变换到屏幕空间，而这一切需要通过构建viewport矩阵来完成。</p>
<p>2.到达屏幕空间的顶点每三个一组构成一个三角形图元，这也是光栅化的最小处理单元（对每个三角形图元进行光栅化/triangle Pipeline）。</p>
<p>3.经过上一步的坐标系转换，我们可以拿到屏幕空间三角形的三个顶点坐标，这里我们可以遍历屏幕上的所有像素点，进行inSide判定，但是这样做有个问题，每次光栅化三角形遍历屏幕上所有像素，效率太低，解决这个问题的其中一种方式就是，可以先计算三角形的包围盒，将遍历的范围缩小至包围盒范围内。</p>
<p><img src="2.png" alt="2.png"></p>
<p>4.那么如何判定一个点是否在三角形内部呢？</p>
<h2 id="InSide判定"><a href="#InSide判定" class="headerlink" title="InSide判定"></a>InSide判定</h2><p>这里给出两种方式：</p>
<h3 id="CrossProduct"><a href="#CrossProduct" class="headerlink" title="CrossProduct"></a>CrossProduct</h3><p><strong><em>分别判断当前像素点是否包含在与边相关的三个半平面中</em></strong></p>
<p><img src="5.png" alt="5.png"></p>
<p><img src="6.png" alt="6.png"></p>
<p><img src="7.png" alt="7.png"></p>
<p>算法很简单，只需要用当前点和三角形其中一边的顶点组成的向量和边向量叉乘即可。</p>
<h3 id="BaryCentric"><a href="#BaryCentric" class="headerlink" title="BaryCentric"></a>BaryCentric</h3><p>通过重心坐标判断，首先计算当前像素点的三角形重心坐标，我们知道顶点重心坐标是顶点对面小三角形和大三角形的面积比，如果点在三角形内部，则重心坐标的三个分量必须同时满足(假设重心坐标的三个分量为$uvw$)：</p>
<p>$u \geq 0 \ \ \ and \ \ \ u \leq 1$</p>
<p>$v \geq 0 \ \ \ and \ \ \ v \leq 1$</p>
<p>$w \geq 0 \ \ \ and \ \ \ w \leq 1$</p>
<h2 id="Triangle-Pipeline"><a href="#Triangle-Pipeline" class="headerlink" title="Triangle Pipeline"></a>Triangle Pipeline</h2><p>多数Mesh都是由三角形图元组成，这主要有以下几点原因：</p>
<ul>
<li>三角形能近似表达所有的形状，只要三角形的数量够多，近似描述任何形状都不成问题。</li>
</ul>
<p><img src="1.jpg" alt="1.jpg"></p>
<ul>
<li>另外一个采用三角形做为基本图元的理由是可以利用三角形的重心坐标对顶点插值</li>
<li>最关键的一个因素是，一旦所有的图元都转换为三角形,GPU可以只处理三角形,只需要做好这一件事,可以把更多的硬件资源用于优化三角形的绘制(triangle pipeline)</li>
</ul>
<h2 id="NdcSpace-→-ScreenSpace"><a href="#NdcSpace-→-ScreenSpace" class="headerlink" title="NdcSpace → ScreenSpace"></a>NdcSpace → ScreenSpace</h2><p>光栅化的第一步步骤是坐标空间的转换，经过图形管线处理过的顶点位于$[-1, 1]^3$的NDC空间中，而屏幕空间是由实际的宽高组成的（width∗heightwidth * heightwidth∗height个像素点）,因此需要矩阵将元素从NDCSpace转换到ScreenSpace，这个任务交由Viewport来完成。</p>
<h3 id="Viewport"><a href="#Viewport" class="headerlink" title="Viewport"></a>Viewport</h3><p>Viewport矩阵在上一章已经做过详细推导，这里再复述一遍。<br>用struct封装Viewport类：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Viewport</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">Viewport</span>() = <span class="keyword">default</span>;</span><br><span class="line">	<span class="built_in">Viewport</span>(<span class="type">uint32_t</span> x, <span class="type">uint32_t</span> y, <span class="type">uint32_t</span> width, <span class="type">uint32_t</span> height):<span class="built_in">width</span>(width), <span class="built_in">height</span>(height)</span><br><span class="line">	&#123;</span><br><span class="line">		transform =</span><br><span class="line">		&#123;</span><br><span class="line">			&#123; width / <span class="number">2</span>,     <span class="number">0</span>,              <span class="number">0</span>, <span class="number">0</span> &#125;,</span><br><span class="line">			&#123; <span class="number">0</span>,             height / <span class="number">2</span>,     <span class="number">0</span>, <span class="number">0</span> &#125;,</span><br><span class="line">			&#123; <span class="number">0</span>,             <span class="number">0</span>,              <span class="number">1</span>, <span class="number">0</span> &#125;,</span><br><span class="line">			&#123; width / <span class="number">2</span> + x, height / <span class="number">2</span> + y, <span class="number">0</span>, <span class="number">1</span> &#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">uint32_t</span> width = <span class="number">0</span>;</span><br><span class="line">	<span class="type">uint32_t</span> height = <span class="number">0</span>;</span><br><span class="line">	glm::mat4 transform = glm::<span class="built_in">identity</span>&lt;glm::mat4&gt;();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>需要注意的是viewport transform矩阵的构造过程，用一张图来说明：</p>
<p><img src="3.jpg" alt="3.jpg"></p>
<ol>
<li>对$x$轴和$y$轴进行 $width/2$,$height/2$的缩放</li>
<li>平移（$width/2 + x$,$height/2 + y$）,$x,y$分别为传入的相对于坐标原点的偏移量</li>
</ol>
<p><strong><em>注：由于NDCSpace在三维空间，以上推导涉及平移变换，三维空间的平移变换需要通过四维其次空间的仿射变换来表示，因此构造的变换矩阵如上述代码所示（mat4x4）。</em></strong></p>
<h2 id="三角形包围盒"><a href="#三角形包围盒" class="headerlink" title="三角形包围盒"></a>三角形包围盒</h2><p>计算三角形包围盒很简单，只需要遍历三角形三个顶点，找到最小和最大的xy即可。首先声明一个BoundingBox struct：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">BoundingBox</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">BoundingBox</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">BoundingBox</span>(<span class="type">const</span> glm::vec2&amp; min, <span class="type">const</span> glm::vec2&amp; max) :<span class="built_in">min</span>(min), <span class="built_in">max</span>(max) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    glm::vec2 min;</span><br><span class="line">    glm::vec2 max;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>计算三角形包围盒代码实现：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CalcBoundingBox</span>(glm::vec4* triangleVertices)</span><br><span class="line">&#123;</span><br><span class="line">	BoundingBox bbox;</span><br><span class="line">	glm::vec2 min &#123; <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line">	glm::vec2 max &#123; viewport.width - <span class="number">1</span>, viewport.height - <span class="number">1</span> &#125;;</span><br><span class="line">	bbox.min = max;</span><br><span class="line">	bbox.max = min;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		bbox.min.x = glm::<span class="built_in">min</span>(bbox.min.x, triangleVertices[i].x);</span><br><span class="line">		bbox.min.y = glm::<span class="built_in">min</span>(bbox.min.y, triangleVertices[i].y);</span><br><span class="line">		bbox.max.x = glm::<span class="built_in">max</span>(bbox.max.x, triangleVertices[i].x);</span><br><span class="line">		bbox.max.y = glm::<span class="built_in">max</span>(bbox.max.y, triangleVertices[i].y);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	bbox.min.x = glm::<span class="built_in">max</span>(min.x, bbox.min.x);</span><br><span class="line">	bbox.min.y = glm::<span class="built_in">max</span>(min.y, bbox.min.y);</span><br><span class="line">	bbox.max.x = glm::<span class="built_in">min</span>(max.x, bbox.max.x);</span><br><span class="line">	bbox.max.y = glm::<span class="built_in">min</span>(max.y, bbox.max.y);</span><br><span class="line">	<span class="keyword">return</span> bbox;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="重心坐标"><a href="#重心坐标" class="headerlink" title="重心坐标"></a>重心坐标</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p><img src="9.png" alt="9.png"></p>
<p>对于同一空间内的三角形$\bigtriangleup V0V1V2$和任意一点$P$,必定存在三个数$uvw$,满足：</p>
<p>$u + v + w = 1$</p>
<p>$P = u <em> V0 + v </em> V1 + w * V2$;</p>
<p>则$(u, v, w)$就称为此三角形上$P$点的<strong>重心坐标</strong>。下边我们从几个不同的角度理解重心坐标的几何意义。</p>
<h3 id="高度比"><a href="#高度比" class="headerlink" title="高度比"></a>高度比</h3><p>重心坐标可以看作$P$点到对面距离和三角形高度比：<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f6e50d371e63476484048a90d057f4ed~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1148&amp;h=506&amp;s=315636&amp;e=png&amp;b=fefefe" alt="8.jpg"></p>
<h3 id="面积比"><a href="#面积比" class="headerlink" title="面积比"></a>面积比</h3><p>重心坐标同样可以理解为$P$点拆分的三个小三角形和大三角形的面积比：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb03b0491f26406da8c9d6fab0f8ecee~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1118&amp;h=485&amp;s=220600&amp;e=png&amp;b=fefefe" alt="10.jpg"></p>
<h3 id="线性组合"><a href="#线性组合" class="headerlink" title="线性组合"></a>线性组合</h3><p>根据重心坐标的定义：<br>$P = u <em> V0 + v </em> V1 + w * V2$</p>
<p>我们将该公式做下变形：</p>
<p>$P = (1 - v - w) <em> V0 + v </em> V1 + w * V2$</p>
<p>$P = V0 - v <em> V0 - w </em> V0 + v <em> V1 + w </em> V2$</p>
<p>$P = V0 + v(V1 - V0) + w(V2 - V0)$</p>
<p>$P = V0 + v\overrightarrow{V01} + w \overrightarrow{V02}$</p>
<p>通过以上推导,我们得出结论：<strong>重心坐标$(v,w)$可以看作以$V0$为原点，$\overrightarrow{V01}$和$\overrightarrow{V02}$为轴构成坐标系的$P$点坐标</strong></p>
<p><img src="11.jpg" alt="11.jpg"></p>
<h3 id="计算重心坐标"><a href="#计算重心坐标" class="headerlink" title="计算重心坐标"></a>计算重心坐标</h3><p>三角形重心坐标的计算很简单,只需要对上述推导做简单变形即可,以下是详细的推导步骤:</p>
<p>已知:</p>
<p>$u + v + w = 1$</p>
<p>$P = u <em> V0 + v </em> V1 + w * V2$</p>
<p>推导:</p>
<p>$\Rightarrow \ \ \ \ P = (1 - v - w) <em> V0 + v </em> V1 + w * V2$</p>
<p>$\Rightarrow \ \ \ \ P = V0 - v <em> V0 - w </em> V0 + v <em> V1 + w </em> V2$</p>
<p>$\Rightarrow \ \ \ \ P = V0 + v(V1 - V0) + w(V2 - V0)$</p>
<p>$\Rightarrow \ \ \ \ 1 * (V0 - P) + v(V1 - V0) + w(V2 - V0) = 0$</p>
<p>$\Rightarrow \ \ \ \ 1 <em> \overrightarrow{V0P} + v </em> \overrightarrow{V10} + w * \overrightarrow{V20} = 0$</p>
<p>$\Rightarrow \ \ \ \ \overrightarrow{x} = (1, v, w)$</p>
<p>$\Rightarrow \ \ \ \ \overrightarrow{y} = (\overrightarrow{V0P}.x, \overrightarrow{V10}.x, \overrightarrow{V20}.x)$</p>
<p>$\Rightarrow \ \ \ \ \overrightarrow{z} = (\overrightarrow{V0P}.y, \overrightarrow{V10}.y, \overrightarrow{V20}.y)$</p>
<p>$\Rightarrow \ \ \ \ \overrightarrow{x} = \overrightarrow{y} \times \overrightarrow{z}$</p>
<p>以下是c++代码实现部分:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">BaryCentric</span>(<span class="type">const</span> glm::vec4* triangleVertices, <span class="type">const</span> glm::vec2&amp; p)</span><br><span class="line">&#123;</span><br><span class="line">    glm::vec2 v0 &#123; triangleVertices[<span class="number">0</span>] &#125;;</span><br><span class="line">    glm::vec2 v1 &#123; triangleVertices[<span class="number">1</span>] &#125;;</span><br><span class="line">    glm::vec2 v2 &#123; triangleVertices[<span class="number">2</span>] &#125;;</span><br><span class="line"></span><br><span class="line">    glm::vec2 v01 = v1 - v0;</span><br><span class="line">    glm::vec2 v02 = v2 - v0;</span><br><span class="line">    glm::vec2 vp0 = v0 - p;</span><br><span class="line">    glm::vec3 vwz = glm::<span class="built_in">cross</span>(glm::<span class="built_in">vec3</span>(v01.x, v02.x, vp0.x), glm::<span class="built_in">vec3</span>(v01.y, v02.y, vp0.y));</span><br><span class="line">    <span class="keyword">if</span> (vwz.z &lt; <span class="number">1e-2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="number">-1</span>, <span class="number">1</span>, <span class="number">1</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">float</span> v = vwz.x / vwz.z;</span><br><span class="line">    <span class="type">float</span> w = vwz.y / vwz.z;</span><br><span class="line">    <span class="type">float</span> u = <span class="number">1.0</span> - (v + w);</span><br><span class="line">    <span class="keyword">return</span> &#123; u, v, w &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="绘制"><a href="#绘制" class="headerlink" title="绘制"></a>绘制</h2><p>通过上一步计算得到重心坐标后,就可以分别对其三个分量进行判断,如果任意一个分量小于0,则当前像素点在三角形外,跳过继续.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">glm::vec3 baryCentric = <span class="built_in">BaryCentric</span>(screenSpaceVertices.<span class="built_in">data</span>(), p);</span><br><span class="line"><span class="keyword">if</span> (baryCentric.x &lt;<span class="number">0</span> || baryCentric.y &lt; <span class="number">0</span> || baryCentric.z &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">winHandle-&gt;<span class="built_in">DrawPoint</span>(p.x, p.y, drawColor);</span><br></pre></td></tr></table></figure>
<h1 id="Renderer"><a href="#Renderer" class="headerlink" title="Renderer"></a>Renderer</h1><p>把以上步骤串联起来,我们可以构造简化版本的Renderer:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Renderer.h</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Renderer</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Renderer</span>() = <span class="keyword">default</span>;</span><br><span class="line">    ~<span class="built_in">Renderer</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetDrawHandle</span><span class="params">(Window* win)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Draw</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Rasterize</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">BoundingBox <span class="title">CalcBoundingBox</span><span class="params">(glm::vec4* triangleVertices)</span></span>;</span><br><span class="line">    <span class="function">glm::vec3 <span class="title">BaryCentric</span><span class="params">(<span class="type">const</span> glm::vec4* triangleVertices, <span class="type">const</span> glm::vec2&amp; p)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetViewport</span><span class="params">(<span class="type">uint32_t</span> x, <span class="type">uint32_t</span> y, <span class="type">uint32_t</span> w, <span class="type">uint32_t</span> h)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Viewport viewport&#123;&#125;;</span><br><span class="line">    Window* winHandle = <span class="literal">nullptr</span>;</span><br><span class="line">    std::array&lt;glm::vec4, 3&gt; triangleVertices = &#123; </span><br><span class="line">            glm::<span class="built_in">vec4</span>( <span class="number">-0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>),</span><br><span class="line">            glm::<span class="built_in">vec4</span>(  <span class="number">0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>),</span><br><span class="line">            glm::<span class="built_in">vec4</span>(  <span class="number">0.0f</span>,  <span class="number">0.5f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">    glm::vec3 drawColor &#123; <span class="number">230</span>, <span class="number">80</span>, <span class="number">50</span> &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Renderer.cpp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Renderer::SetDrawHandle</span><span class="params">(Window* win)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    winHandle = win;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Renderer::Draw</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Rasterize</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Renderer::Rasterize</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::array&lt;glm::vec4, 4&gt; screenSpaceVertices;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        screenSpaceVertices[i] = viewport.transform * triangleVertices[i];</span><br><span class="line">    &#125;</span><br><span class="line">    BoundingBox bbox = <span class="built_in">CalcBoundingBox</span>(screenSpaceVertices.<span class="built_in">data</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> y = bbox.min.y; y &lt;= bbox.max.y; y++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> x = bbox.min.x; x &lt;= bbox.max.x; x++)</span><br><span class="line">        &#123;</span><br><span class="line">            glm::vec2 p &#123; x + <span class="number">0.5f</span>, y + <span class="number">0.5f</span> &#125;;</span><br><span class="line">            glm::vec3 baryCentric = <span class="built_in">BaryCentric</span>(screenSpaceVertices.<span class="built_in">data</span>(), p);</span><br><span class="line">            <span class="keyword">if</span> (baryCentric.x &lt;<span class="number">0</span> || baryCentric.y &lt; <span class="number">0</span> || baryCentric.z &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            winHandle-&gt;<span class="built_in">DrawPoint</span>(p.x, p.y, drawColor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BoundingBox <span class="title">Renderer::CalcBoundingBox</span><span class="params">(glm::vec4* triangleVertices)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BoundingBox bbox;</span><br><span class="line">    glm::vec2 min &#123; <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line">    glm::vec2 max &#123; viewport.width - <span class="number">1</span>, viewport.height - <span class="number">1</span> &#125;;</span><br><span class="line">    bbox.min = min;</span><br><span class="line">    bbox.max = max;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        bbox.min.x = glm::<span class="built_in">min</span>(bbox.min.x, triangleVertices[i].x);</span><br><span class="line">        bbox.min.y = glm::<span class="built_in">min</span>(bbox.min.y, triangleVertices[i].y);</span><br><span class="line">        bbox.max.x = glm::<span class="built_in">max</span>(bbox.max.x, triangleVertices[i].x);</span><br><span class="line">        bbox.max.y = glm::<span class="built_in">max</span>(bbox.max.y, triangleVertices[i].y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bbox.min.x = glm::<span class="built_in">max</span>(min.x, bbox.min.x);</span><br><span class="line">    bbox.min.y = glm::<span class="built_in">max</span>(min.y, bbox.min.y);</span><br><span class="line">    bbox.max.x = glm::<span class="built_in">min</span>(max.x, bbox.max.x);</span><br><span class="line">    bbox.max.y = glm::<span class="built_in">min</span>(max.y, bbox.max.y);</span><br><span class="line">    <span class="keyword">return</span> bbox;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">glm::vec3 <span class="title">Renderer::BaryCentric</span><span class="params">(<span class="type">const</span> glm::vec4* triangleVertices, <span class="type">const</span> glm::vec2&amp; p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    glm::vec2 v0 &#123; triangleVertices[<span class="number">0</span>] &#125;;</span><br><span class="line">    glm::vec2 v1 &#123; triangleVertices[<span class="number">1</span>] &#125;;</span><br><span class="line">    glm::vec2 v2 &#123; triangleVertices[<span class="number">2</span>] &#125;;</span><br><span class="line"></span><br><span class="line">    glm::vec2 v01 = v1 - v0;</span><br><span class="line">    glm::vec2 v02 = v2 - v0;</span><br><span class="line">    glm::vec2 vp0 = v0 - p;</span><br><span class="line">    glm::vec3 vwz = glm::<span class="built_in">cross</span>(glm::<span class="built_in">vec3</span>(v01.x, v02.x, vp0.x), glm::<span class="built_in">vec3</span>(v01.y, v02.y, vp0.y));</span><br><span class="line">    <span class="keyword">if</span> (vwz.z &lt; <span class="number">1e-2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="number">-1</span>, <span class="number">1</span>, <span class="number">1</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">float</span> v = vwz.x / vwz.z;</span><br><span class="line">    <span class="type">float</span> w = vwz.y / vwz.z;</span><br><span class="line">    <span class="type">float</span> u = <span class="number">1.0</span> - (v + w);</span><br><span class="line">    <span class="keyword">return</span> &#123; u, v, w &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Renderer::SetViewport</span><span class="params">(<span class="type">uint32_t</span> x, <span class="type">uint32_t</span> y, <span class="type">uint32_t</span> w, <span class="type">uint32_t</span> h)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    viewport.<span class="built_in">Set</span>(x, y, w, h);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><em>在光栅化函数里,首先我们通过Viewport矩阵将NDCSpace的顶点信息转换到ScreenSpace,然后计算三角形包围盒,遍历包围盒的二维空间像素点,对每一个像素点计算重心坐标,判断重心坐标是否小于0来判断当前像素点是否在三角形内部,如果在三角形内部,处理着色逻辑.</em></strong></p>
<p>在RenderLoop代码中，调用softRenderer的draw函数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Window::Run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!shouldClosed)</span><br><span class="line">    &#123;</span><br><span class="line">        SDL_Event event;</span><br><span class="line">        <span class="built_in">SDL_PollEvent</span>(&amp;event);</span><br><span class="line">        <span class="keyword">if</span> (event.type == SDL_QUIT)</span><br><span class="line">        &#123;</span><br><span class="line">                shouldClosed = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">Clear</span>();</span><br><span class="line">        softRenderer-&gt;<span class="built_in">Draw</span>();</span><br><span class="line">        <span class="built_in">SDL_RenderPresent</span>(drawHandle);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，如果一切正常，你将在屏幕中心看到一个橙色的三角形：</p>
<p><img src="12.jpg" alt="12.jpg"></p>
<h2 id="绘制彩色三角形"><a href="#绘制彩色三角形" class="headerlink" title="绘制彩色三角形"></a>绘制彩色三角形</h2><p>让我们再进一步，画一个彩色三角形，基本思路是读取三角形三个顶点属性的颜色值，通过光栅化得到的重心坐标对属性进行插值，对当前像素点着色。<br>首先改造下代码，由于现在顶点不仅仅有Position一个属性，多了一个Color，用简单的struct对其封装：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Vertex</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">Vertex</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Vertex</span>(<span class="type">const</span> glm::vec4&amp; p, <span class="type">const</span> glm::vec3&amp; c) :<span class="built_in">Position</span>(p), <span class="built_in">Color</span>(c) &#123;&#125;</span><br><span class="line">    glm::vec4 Position;</span><br><span class="line">    glm::vec3 Color;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在Renderer临时声明的三角形顶点数组添加Color属性：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::array&lt;Vertex, 3&gt; triangleVertices = &#123; </span><br><span class="line">    <span class="built_in">Vertex</span>(glm::<span class="built_in">vec4</span>(<span class="number">-0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">255.0f</span>, <span class="number">0.0f</span>)),</span><br><span class="line">    <span class="built_in">Vertex</span>(glm::<span class="built_in">vec4</span>(  <span class="number">0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">255.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>)),</span><br><span class="line">    <span class="built_in">Vertex</span>(glm::<span class="built_in">vec4</span>(  <span class="number">0.0f</span>,  <span class="number">0.5f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">255.0f</span>))</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在光栅化函数中，读取三角形三个顶点的Color值，通过重心坐标插值计算得到当前像素点的颜色值：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Renderer::Rasterize</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::array&lt;glm::vec4, 4&gt; screenSpaceVertices;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        screenSpaceVertices[i] = viewport.transform * triangleVertices[i].Position;</span><br><span class="line">    &#125;</span><br><span class="line">    BoundingBox bbox = <span class="built_in">CalcBoundingBox</span>(screenSpaceVertices.<span class="built_in">data</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> y = bbox.min.y; y &lt;= bbox.max.y; y++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> x = bbox.min.x; x &lt;= bbox.max.x; x++)</span><br><span class="line">        &#123;</span><br><span class="line">            glm::vec2 p &#123; x + <span class="number">0.5f</span>, y + <span class="number">0.5f</span> &#125;;</span><br><span class="line">            glm::vec3 baryCentric = <span class="built_in">BaryCentric</span>(screenSpaceVertices.<span class="built_in">data</span>(), p);</span><br><span class="line">            <span class="keyword">if</span> (baryCentric.x &lt;<span class="number">0</span> || baryCentric.y &lt; <span class="number">0</span> || baryCentric.z &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//重心坐标插值属性值（线性组合）</span></span><br><span class="line">            glm::vec3 drawColor = &#123; </span><br><span class="line">                baryCentric.x * triangleVertices[<span class="number">0</span>].Color + </span><br><span class="line">                baryCentric.y * triangleVertices[<span class="number">1</span>].Color + </span><br><span class="line">                baryCentric.z * triangleVertices[<span class="number">2</span>].Color </span><br><span class="line">            &#125;;</span><br><span class="line">            winHandle-&gt;<span class="built_in">DrawPoint</span>(p.x, p.y, drawColor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="13.jpg" alt="13.jpg"></p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>本章我们实现了一个基础版光栅化器，通过计算重心坐标，对属性插值，绘制了一个彩色三角形。完成了光栅化器基本结构的搭建，后续我们会在此基础上不断完善填充细节，在进入三维空间后，通过zBuffer解决遮挡问题，以及透视除法形成的非线性空间插值如何进行矫正等等。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Computer-Graphic/" rel="tag"># Computer Graphic</a>
              <a href="/tags/Soft-Renderer/" rel="tag"># Soft Renderer</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/10/03/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0%E8%BD%AF%E6%B8%B2%E6%9F%93-%E4%BA%8C-%EF%BC%9A%E7%AA%97%E5%8F%A3%E7%B3%BB%E7%BB%9F/" rel="prev" title="从零实现软渲染(二)：窗口系统">
                  <i class="fa fa-angle-left"></i> 从零实现软渲染(二)：窗口系统
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    
  
  <div class="comments giscus-container">
  </div>
  
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">KenShin</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">105k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">6:22</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/kenshin627" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.min.js","integrity":"sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  <script src="/js/third-party/pace.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="giscus" type="application/json">{"enable":true,"repo":"Kenshin627/BlogGiscus","repo_id":"R_kgDOJ-E6Aw","category":"Announcements","category_id":"DIC_kwDOJ-E6A84CYCOU","mapping":"pathname","strict":0,"reactions_enabled":1,"emit_metadata":1,"theme":"dark_dimmed","lang":"zh-CN","crossorigin":"anonymous","input_position":"top","loading":"lazy"}</script>

<script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.page.comments) return;

  NexT.utils.loadComments('.giscus-container')
    .then(() => NexT.utils.getScript('https://giscus.app/client.js', {
      attributes: {
        async                   : true,
        crossOrigin             : 'anonymous',
        'data-repo'             : CONFIG.giscus.repo,
        'data-repo-id'          : CONFIG.giscus.repo_id,
        'data-category'         : CONFIG.giscus.category,
        'data-category-id'      : CONFIG.giscus.category_id,
        'data-mapping'          : CONFIG.giscus.mapping,
        'data-strict'           : CONFIG.giscus.strict,
        'data-reactions-enabled': CONFIG.giscus.reactions_enabled,
        'data-emit-metadata'    : CONFIG.giscus.emit_metadata,
        'data-theme'            : CONFIG.giscus.theme,
        'data-lang'             : CONFIG.giscus.lang,
        'data-input-position'   : CONFIG.giscus.input_position,
        'data-loading'          : CONFIG.giscus.loading
      },
      parentNode: document.querySelector('.giscus-container')
    }));
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":120,"height":240},"mobile":{"show":false},"react":{"opacityDefault":1,"opacityOnHover":0.5},"log":false,"tagMode":false});</script></body>
</html>
